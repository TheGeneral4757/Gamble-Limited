{% extends "base.html" %}

{% block content %}
<div class="admin-panel">
    <div class="admin-header">
        <h2>ğŸ” Admin Control Panel</h2>
        <p class="admin-welcome">Welcome, Administrator. You have unlimited funds.</p>
    </div>

    <div class="admin-grid">
        <!-- Platform Stats -->
        <div class="admin-card">
            <h3>ğŸ“Š Platform Overview</h3>
            <div class="status-grid">
                <div class="status-item">
                    <span class="label">Total Users</span>
                    <span class="value">{{ stats.users.user_count or 0 }}</span>
                </div>
                <div class="status-item">
                    <span class="label">Total Games</span>
                    <span class="value">{{ stats.users.total_games or 0 }}</span>
                </div>
                <div class="status-item">
                    <span class="label">Total Wagered</span>
                    <span class="value">${{ "%.2f"|format(stats.users.platform_wagered or 0) }}</span>
                </div>
                <div class="status-item">
                    <span class="label">Total Cash</span>
                    <span class="value cash">${{ "%.2f"|format(stats.users.total_cash or 0) }}</span>
                </div>
                <div class="status-item">
                    <span class="label">Total Credits</span>
                    <span class="value credits">{{ "%.2f"|format(stats.users.total_credits or 0) }} CR</span>
                </div>
                <div class="status-item">
                    <span class="label">Transactions</span>
                    <span class="value">{{ stats.transactions.tx_count or 0 }}</span>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="admin-card">
            <h3>âš¡ Quick Actions</h3>
            <div class="quick-actions">
                <a href="/" class="admin-btn play">ğŸ® Play Games</a>
                <a href="/exchange" class="admin-btn">ğŸ’± Exchange</a>
            </div>
        </div>

        <!-- Game Stats -->
        <div class="admin-card">
            <h3>ğŸ² Game Statistics</h3>
            <div class="game-stats-list">
                {% for game in game_stats %}
                <div class="game-stat-row">
                    <span class="game-name">{{ game.game|capitalize }}</span>
                    <span class="stat">{{ game.total_plays }} plays</span>
                    <span class="stat wagered">${{ "%.0f"|format(game.total_wagered or 0) }}</span>
                    <span class="stat won">${{ "%.0f"|format(game.total_won or 0) }}</span>
                </div>
                {% endfor %}
                {% if not game_stats %}
                <p style="color: var(--text-dim);">No game data yet</p>
                {% endif %}
            </div>
        </div>

        <!-- Leaderboard -->
        <div class="admin-card">
            <h3>ğŸ† Top Players</h3>
            <div class="leaderboard-list">
                {% for player in leaderboard %}
                <div class="leaderboard-row">
                    <span class="rank">#{{ loop.index }}</span>
                    <span class="player-name">{{ player.username }}</span>
                    <span class="stat won">${{ "%.0f"|format(player.total_won or 0) }}</span>
                </div>
                {% endfor %}
                {% if not leaderboard %}
                <p style="color: var(--text-dim);">No players yet</p>
                {% endif %}
            </div>
        </div>

        <!-- User Management -->
        <div class="admin-card wide">
            <h3>ğŸ‘¥ User Management</h3>
            <p style="color: var(--text-dim); margin-bottom: 15px; font-size: 0.9rem;">
                To manage users: Use the API endpoints directly or restart server to apply changes.
            </p>
            <div class="users-table-container">
                <table class="users-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Username</th>
                            <th>Cash</th>
                            <th>Credits</th>
                            <th>Games</th>
                            <th>Total Wagered</th>
                            <th>Total Won</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for u in users %}
                        <tr>
                            <td>{{ u.id }}</td>
                            <td><strong>{{ u.username }}</strong></td>
                            <td class="cash">${{ "%.2f"|format(u.cash) }}</td>
                            <td class="credits">{{ "%.2f"|format(u.credits) }} CR</td>
                            <td>{{ u.games_played }}</td>
                            <td>${{ "%.2f"|format(u.total_wagered) }}</td>
                            <td class="won">${{ "%.2f"|format(u.total_won) }}</td>
                        </tr>
                        {% endfor %}
                        {% if not users %}
                        <tr>
                            <td colspan="7" style="text-align: center; color: var(--text-dim);">No users yet</td>
                        </tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Session -->
        <div class="admin-card">
            <h3>ğŸ”’ Session</h3>
            <p style="color: var(--text-dim); margin-bottom: 20px;">Admin session expires after 1 hour.</p>
            <a href="/logout" class="admin-btn logout">Logout</a>
        </div>

        <!-- API Info -->
        <div class="admin-card">
            <h3>ğŸ”§ Admin API</h3>
            <div style="font-size: 0.85rem; color: var(--text-dim);">
                <p style="margin-bottom: 8px;"><strong>Reset User:</strong> POST /admin/api/reset-user</p>
                <p style="margin-bottom: 8px;"><strong>Delete User:</strong> POST /admin/api/delete-user</p>
                <p style="margin-bottom: 8px;"><strong>Grant Funds:</strong> POST /admin/api/grant-funds</p>
                <p><strong>Clear All:</strong> POST /admin/api/clear-all</p>
            </div>
        </div>
    </div>
</div>
{% endblock %}